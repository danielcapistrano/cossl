---
title: "Results"
format: 
    html: 
        toc: true
        toc-location: left
---

```{r}

# Loading packages
library(tidyverse) #data manipulation
library(haven) #imports SPSS file
library(scales) #wrap long labels on charts
library(gridExtra) #combine different plots in one image
library(gt) #formatted tables
library(grid)
library(gtExtras)

# Importing working dataset
df_ucd <- read_sav("data/UCD_Survey_20221217.sav")

# Derived variables

# Demographic
df_ucd$female <- if_else(df_ucd$demgender == 2, "Female", "Others")
df_ucd$cossl <- if_else(df_ucd$demcollege == 5, "CoSSL", "Others")
df_ucd$year1 <- if_else(df_ucd$demyear == 1, "First Year", "Others")

#Knowledge
df_ucd$knowsmth <- if_else(df_ucd$knhowmuch %in% c(3, 4), "lot/moderate", "little/nothing")
df_ucd$easyknezcntry <- if_else(df_ucd$knezcntry %in% c(3, 4),  1, 0)
df_ucd$easyknezexplco2 <- if_else(df_ucd$knezexplco2 %in% c(3, 4), 1, 0)
df_ucd$easyknezrefugee <- if_else(df_ucd$knezrefugee %in% c(3, 4),  1, 0)

#Anxiety
df_ucd$anxday <- if_else(df_ucd$anxthink %in% c(6, 7), 1, 0)
df_ucd$anxweek <- if_else(df_ucd$anxthink > 3, 1, 0)
df_ucd$veryworried <- if_else(df_ucd$anxworry %in% c(1, 7), 1, 0)


```


```{r}
# Function to get rounded percentage value for valid observations
get_perc <- function(variable, value){
    numerat <- sum(df_ucd[[variable]] == value, na.rm = T)
    denominat <- sum(!is.na(df_ucd[[variable]]))
    paste0(round(numerat/denominat*100), "%")
    }

# Function to get percentages by groups
get_perc_grp <- function(mainvar, mainvalue, group, grpvalue){
    df_new <- df_ucd[df_ucd[[group]] == grpvalue,]
    numerat <- sum(df_new[[mainvar]] == mainvalue, na.rm = T)
    denominat <- sum(!is.na(df_new[[mainvar]]))
    paste0(round(numerat/denominat*100),"%")
}
    
```

The questionnaire was divided into four main sections: Knowledge, Anxiety, Action and UCD. In this report, we focus on the results about the UCD questions and the responses from students of the College of Social Sciences and Law (CoSSL). The authors are preparing different papers analysing the data generated by the other sections of the questionnaire. 


## Knowledge

### General knowledge

When asked about how much they know in relation to climate change `r get_perc("knowsmth", "lot/moderate")` of students indicate that they know *a lot* or *a moderate amount* about it. This percentage is lower among students from the CoSSL (`r get_perc_grp("knowsmth", "lot/moderate", "demcollege",5)`).

### Specific knowledge
Based on questions developed by the OECD [^16], students were asked to what extent they could explain some issues related to climate change. Among all issues, UCD students find the easiest to explain why some countries suffer more from global climate change than others, with `r get_perc("easyknezcntry", 1)` stating that they could do this easily or, at least, with some effort. This aspect is also mentioned as one of the easiest for 15-year-old participants of the OECD assessment across 66 countries, with a similar proportion of 72% on average. On the other hand, the hardest aspect to explain according to UCD students is *how economic crises in single countries affect the global economy*, with only half of the respondents indicating that they could do this easily or with a bit of effort. 

There are also significant differences across colleges. Only `r get_perc_grp("easyknezexplco2", 1, "cossl", "CoSSL")`  of CoSSL students indicate that they can explain *how carbon dioxide emissions affect global climate change* compared to `r get_perc_grp("easyknezexplco2", 1, "cossl", "Others")` of their colleagues from other colleges. Conversely, `r get_perc_grp("easyknezrefugee", 1, "cossl", "CoSSL")` of CoSSL can *Discuss the different reasons why people become refugees* and only `r get_perc_grp("easyknezrefugee", 1, "cossl", "Others")` of respondents from other colleges can do that easily or with some effort. 

[^16]: OECD. PISA 2018 Results (Volume VI): Are Students Ready to Thrive in an Interconnected World? PISA. OECD, 2020. https://doi.org/10.1787/d5f68679-en.


### Information sources
The most cited source of information about the environmental crisis that UCD respondents rely on is *News Sites* (`r round(sum(df_ucd$knsrcsites, na.rm=T)/nrow(df_ucd)*100)`%) followed by *Environmental organisations* (`r round(sum(df_ucd$knsrcenvorg, na.rm=T)/nrow(df_ucd)*100)`%) and *Instagram* (`r round(sum(df_ucd$knsrcinsta, na.rm=T)/nrow(df_ucd)*100)`%). The least cited sources are *Facebook* (`r round(sum(df_ucd$knsrcface, na.rm=T)/nrow(df_ucd)*100)`%) and *Youth groups* (`r round(sum(df_ucd$knsrcyouth, na.rm=T)/nrow(df_ucd)*100)`%). Located also at the bottom of the ranking, only `r round(sum(df_ucd$knsrcucdoth, na.rm=T)/nrow(df_ucd)*100)`% of students mentioned that they rely on information from *other sources at UCD (outside of lectures)*, with `r round(sum(df_ucd$knsrcucdtch, na.rm=T)/nrow(df_ucd)*100)`% of them relying on information from *modules/lectures in UCD*. 


```{r}

# creating vector with list of variables related to sources
list_sources <- c(
    "knsrcsites", "knsrcinflu", "knsrctwt", "knsrcface", "knsrcinsta",
    "knsrcpodc", "knsrcpubfig", "knsrcbook", "knsrcucdtch", "knsrcucdoth",
    "knsrclocal", "knsrcemail", "knsrcfriend", "knsrcyouth", "knsrcenvorg"
)

# getting percentages for each source
tb_sources_values <- 
    df_ucd |>
        select(all_of(list_sources)) |>
        map_dbl(function(x) sum(x, na.rm = T)) |>
        enframe() |> 
        mutate(percentage = value/169*100)

# getting label of the variables of each source 
tb_sources_labels <- 
    df_ucd |>
        select(all_of(list_sources)) |>
        map_dfr(function(x) attributes(x)$label) |> 
        pivot_longer(everything(), names_to = "name", values_to = "label") |>
        mutate(label = str_remove(label, ".*apply. "))

# joining tables (values and labels)
tb_sources <- left_join(tb_sources_values, tb_sources_labels, by = "name")

# reordering the sequence of sources by percentage
tb_sources$label <- fct_reorder(tb_sources$label, tb_sources$percentage)

# creating plot
tb_sources  |>
    ggplot(aes(x=label, y = percentage)) +
    geom_point(aes(x= label, y = percentage), size = 2.5, colour = "darkgreen") +
    geom_text(aes(label = round(percentage)), colour = "grey40", hjust = -0.5) +
    geom_segment(aes(x = label, xend = label, y = 0, yend = percentage), colour = "grey40") +
    scale_x_discrete(labels = label_wrap(35)) +
    ylim(0,100) +
    coord_flip() +
    labs(x = "Sources", y = "Percentage",
    title = "Which sources do you rely on for information about the environmental crisis?",
    subtitle = "% that mentioned each source") +
    theme_minimal() +
    theme(plot.title.position ="plot") 

```

## Anxiety


When asked how often they think about climate change, `r get_perc("anxweek",1)` of respondents say that they think about it at least every week, with `r get_perc("anxday",1)` thinking about climate change every day or multiple times a day. The groups that present the highest proportion of thinking about it daily are female students (`r get_perc_grp("anxday", 1, "female", "Female")`) and those coming from rural areas (`r get_perc_grp("anxday", 1, "demurbrur", 2)`). In addition, half of the respondents indicated that they are very or extremely worried about climate change. These levels are also higher among female students (`r get_perc_grp("veryworried", 1, "female", "Female")`) and CoSSL students `r get_perc_grp("veryworried", 1, "cossl", "CoSSL")`. 

To investigate this worry in more detail, researchers asked participants to what extent they were worried because of the consequences of climate change to determined groups. 84% of respondents indicated that they were very or extremely worried about the consequences to *Future generations* and only 22% stated that they were very/extremely worried about the consequences to their *lifestyles now*. 


```{r}

# creating vector with list of variables related to concerns

list_concerns <- c(
    "anxconslifestyle", "anxconsfuture", "anxconscommunity", 
    "anxconsireland", "anxconspoor", "anxconsgenerat",
     "anxconsanimals", "anxconsplants"
     )


# getting percentages for each source 
tb_concerned_values <- 
    df_ucd |>
        select(all_of(list_concerns)) |>
        map_dbl(function(x) sum(x %in% c(1,2), na.rm = T)/sum(!is.na(x))*100) |>
        enframe()


# getting label of the variables of each concern 
tb_concerned_labels <- 
    df_ucd |>
        select(all_of(list_concerns)) |>
        map_dfr(function(x) attributes(x)$label) |> 
        pivot_longer(everything(), names_to = "name", values_to = "label") |>
        mutate(label = str_remove(label, ".*for... ")) 

#joining tables
tb_concerned <- left_join(tb_concerned_values, tb_concerned_labels)

# creating function to generate a generic plot
chart_donut <- function(variable, holesize, fillcolour){

    varnumber  <-  as.double(round(tb_concerned[tb_concerned$label == variable,"value"]))
    
    tb_concerned |>
        mutate(nonvalue = 100-value) |>
        select(label, value, nonvalue) |>
        pivot_longer(cols = c(value, nonvalue), names_to = "type", 
                    values_to = "values") |>
        filter(label == variable) |>
        ggplot(aes(x = holesize, y = values, fill = type)) +
        geom_col() +
        scale_fill_manual(values = c("grey80", fillcolour))+
        coord_polar(theta = "y") +
        xlim(c(0.2, holesize + 0.5)) +
        theme_void() +
        theme(legend.position = "none",
                plot.title = element_text(hjust = 0.5)) +
        labs(title = variable) +
        annotate("text", 
                label = varnumber,
                x = 0.2, y = 0, size = 8 + (varnumber/15), color = fillcolour)
}

# creating plot for 4 concerns and arranging the in the same image
grid.arrange(
    chart_donut("Future generations", 3, "darkgreen"),
    #chart_donut("Animals", 3, "darkgreen"),
    chart_donut("Plants", 3, "darkgreen"),
    chart_donut("People in Ireland", 3, "darkgreen"),
    chart_donut("My lifestyle now", 3, "darkgreen"),
    top = textGrob("How worried are you about the issue of climate change because of the consequences for… ?\nPercentage of 'very/extremely worried'\n ", x = 0, hjust = 0))
    

```

The proportion of very/extremely worried students is higher in the CoSSL compared to other colleges for all groups. The highest difference is found in consequences for *My future* and for *Plants* whereas the lowest difference is found in consequences for *People in my community* and for *My lifestyle* now.  

## Action

UCD students were also asked to what extent some groups should be acting more or less to address climate change. For `r get_perc("actmorebusiness", 1)` of the students, "Business" should be acting *much more* to address climate change. This is the highest proportion followed by "Government" (`r get_perc("actmoregov", 1)`) and "Politicians" (`r get_perc("actmorepolit", 1)`). Only `r get_perc("actmorectz", 1)` of respondents indicated that "Citizens" should act *much more* and `r get_perc("actmoreself", 1)` responded that "themselves" should be acting *much more* to address climate change. 

This emphasis on Government's responsibility corroborates the results from a national survey conducted in 2021  with the Irish adult population [^17]. One of the survey items asked if climate change should be a very high, high, medium, or low priority for the Government of Ireland. Among the population, 42% indicated a *very high* priority, and 37% responded that a *high* priority should be given. The same question was asked to UCD students, with `r get_perc("irlgovpriority", 1)` indicating a *very high* priority and `r get_perc("irlgovpriority", 4)` a *high* priority.

```{r}

tb_epa <- data.frame(
    Categories = c("Very high", "High", "Medium", "Low"), 
    Values = c(42, 37, 15, 5),
    Survey = rep("Ireland",4)
)


tb_gov_ucd <-
    df_ucd |> 
        count(Categories = as_factor(irlgovpriority)) |>
        filter(!is.na(Categories)) |>
        mutate(Values = round(prop.table(n), 2)*100,
                Survey = "UCD") |>
        add_row(Categories = "Low", Values = 0, Survey = "UCD") |>
        select(-n)


tb_epa_ucd <- bind_rows(tb_epa, tb_gov_ucd)

 
ggplot(tb_epa_ucd, aes(x = reorder(Categories, Values), y = Values, 
                        fill = Survey, label = Values)) +
    geom_col(position = "dodge", width = 0.6) + 
    geom_text(position = position_dodge(width  = 0.6), hjust = -0.5) +
    scale_fill_manual(values = c("grey80", "darkgreen"))+
    coord_flip() +
    labs(x = "Priority", y = "Percentage", 
    title = "Do you think climate change should be a very high, high, medium, or low priority\nfor the Government of Ireland?") +
    theme_minimal() +
    theme(plot.title.position = "plot")

```


Both surveys also asked when climate change will start to harm people in Ireland. Results from the national survey showed that 47% of the population believes that climate change is already starting to harm people in Ireland. 22% responded *in 10 years*, 29% in *25 years* or more and 2% said that climate change will *never* harm people in Ireland. The same question was asked to UCD students with `r get_perc("irlwhenharm", 1)` saying that people are already being harmed now, `r get_perc("irlwhenharm", 4)` responding *in 10 years* and `r get_perc("irlwhenharm", 8)` saying that climate change will *never* harm people in Ireland.

Finally, in relation to climate-friendly actions that UCD students have taken in the previous 12 months, `r round(sum(df_ucd$actyrfamily, na.rm=T)/nrow(df_ucd)*100)`% mentioned "Talked with family and friends about climate change". This is the most cited action followed by "Punished a company by NOT buying their products because of their contribution to climate change" (`r round(sum(df_ucd$actyrpunished, na.rm=T)/nrow(df_ucd)*100)`%) and "Reduced your meat and/or dairy intake for environmental reasons" (`r round(sum(df_ucd$actyrmeat, na.rm=T)/nrow(df_ucd)*100)`%). Some actions have different levels of support across students from the CoSSL and other colleges as indicated in Table 1. 

```{r}

list_actyear <- c("actyrmeat", "actyrflights", "actyrcontact", "actyrdisobed", 
                "actyrpetition", "actyrvolunteer", "actyrfamily", "actyrvoting", 
            "actyrpunished", "actyrassignment", "actyrmaster", "actyrcareer", "actyrnone")

tb_actions <- 
    df_ucd |>
        filter(cossl == "CoSSL") |>
        select(all_of(list_actyear)) |>
        map_dbl(function(x) sum(x == 1, na.rm = T)/nrow(subset(df_ucd, cossl == "CoSSL"))*100) |>
        enframe()  |>
        rename(cossl = value) |>
        left_join(
            df_ucd |>
            filter(cossl == "Others") |>
            select(all_of(list_actyear)) |>
            map_dbl(function(x) sum(x == 1, na.rm = T)/nrow(subset(df_ucd, cossl == "Others"))*100) |>
            enframe()  |>
            rename(others = value)  
        ) |> mutate(differ = cossl - others) 


tb_actions |>
    left_join(
        df_ucd |>
        select(all_of(list_actyear)) |>
        map_dfr(function(x) attributes(x)$label) |> 
        pivot_longer(everything(), names_to = "name", values_to = "label") |>
        mutate(label = str_remove(label, ".*12 months\\? "))) |>
    mutate(cossl = round(cossl), others = round(others)) |>
    filter(abs(differ)/cossl > 0.1) |>
    arrange(desc(cossl)) |>
    select(label, cossl, others) |>
    gt() |>
    gt_theme_espn() |>
    gt_color_rows(cossl:others, palette = c("white", "#76b68a")) |>
    cols_width(cossl ~ px(80), others ~ px(80)) |>
    cols_label(
        label = "Action",
        cossl = "CoSSL",
        others = "Other colleges"
    ) |>
    tab_header(
        title = md("**Table 1.** Climate-friendly actions that UCD students have taken in the previous 12 months")
    )

```

[^17]: Leiserowitz, A, J Carman, S Rosenthal, L Neyens, J Marlon, M Desmond, S Smith, MF Rochford, J O’Mahony, and L Reaper. “Climate Change in the Irish Mind.” New Haven: Yale Program on Climate Change Communication, 2021. https://www.epa.ie/publications/monitoring--assessment/climate-change/EPA-Climate-in-the-Irish-Mind-REPORT-19.pdf.


## UCD


### Opportunities to Learn

Less than half of the students participating in the survey (`r get_perc("ucdoptlearn", 1)`) said that there have been enough opportunities to learn about climate change and environment-related issues in their experience in UCD. This proportion is similar among students from CoSSL (`r get_perc_grp("ucdoptlearn", 1, "cossl", "CoSSL")`) and other colleges (`r get_perc_grp("ucdoptlearn", 1, "cossl", "Others")`). 

The proportion of female students who indicated that UCD provided enough opportunities to learn about climate change is significantly lower (`r get_perc_grp("ucdoptlearn", 1, "female", "Female")`), compared to non-female students (`r get_perc_grp("ucdoptlearn", 1, "female", "Others")`). 

### Pro-Environmental Activities

Only 1 in 3 students in UCD indicated that there have been enough opportunities to become involved in activities (such as volunteering) related to climate change and environment. 

The percentage of students from CoSSL who declared having those opportunities is lower (`r get_perc_grp("ucdoptinvolv", 1, "cossl", "CoSSL")`) than those from other colleges (`r get_perc_grp("ucdoptinvolv", 1, "cossl", "Others")`). 

In the same way that was observed for learning opportunities, the proportion of respondents who said that UCD provided opportunities to act is lower among female students (`r get_perc_grp("ucdoptinvolv", 1, "female", "Female")`), compared to non-female students (`r get_perc_grp("ucdoptinvolv", 1, "female", "Others")`). 

### Barriers to Climate-Friendly Action and Lifestyle Changes

The survey also asked participants what barriers students in UCD face to take climate-friendly action and lifestyle changes. The most cited barrier is that "*Most students have other more pressing problems that take most of their attention e.g. course work*", mentioned by `r round(sum(df_ucd$ucdbarproblems, na.rm=T)/nrow(df_ucd)*100)`% of the students, `r df_grp <- subset(df_ucd, demcollege == 5); round(sum(df_grp$ucdbarproblems, na.rm=T)/nrow(df_grp)*100)`% among CoSSL and  `r df_grp <- subset(df_ucd, demgender == 2); round(sum(df_grp$ucdbarproblems, na.rm=T)/nrow(df_grp)*100)`% among female students. 

The other top cited barriers are "*Most students don't have enough knowledge on climate change*" (`r round(sum(df_ucd$ucdbarknow, na.rm=T)/nrow(df_ucd)*100)`%) and "*Most students don't have the skills e.g. public speaking / organising*" (`r round(sum(df_ucd$ucdbarskill, na.rm=T)/nrow(df_ucd)*100)`%)

### Opportunities for Further Learning

Finally, participants also indicated several topics related to climate change that they would like to learn more about at UCD. The table below indicates the percentage of participants that mentioned each of the topics. 

```{r}

list_learnmore <- c(
    "ucdtpcclmjust", "ucdtpcaction","ucdtpcprotect",
    "ucdtpcfashion","ucdtpcfood","ucdtpcwaste",
    "ucdtpcbuild","ucdtpceconomy","ucdtpcgarden",
    "ucdtpclobby","ucdtpcpolitics","ucdtpcbusines"
)

tb_learnmore <-
    df_ucd |>
        select(all_of(list_learnmore)) |>
        map_dbl(function(x) sum(x == 1, na.rm = T)/nrow(df_ucd)*100) |>
        enframe()  |>
        left_join(
        df_ucd |>
            select(all_of(list_learnmore)) |>
            map_dfr(function(x) attributes(x)$label) |> 
            pivot_longer(everything(), names_to = "name", values_to = "label") |>
            mutate(label = str_remove(label, ".*you want "))
        ) |> arrange(desc(value)) |>
        rename(Topic = label, Percentage = value) |>
        mutate(Percentage = round(Percentage),
                Bar = Percentage) |>
        select(Topic, Percentage, Bar) 

gt(tb_learnmore) |>
    gt_theme_espn() |>
    tab_header(
        title = md("**Table 2.** Topics that students would like to learn more about")
    ) |>
    gt_plt_bar(column = Bar, keep_column = F, width = 20,
            color = "darkgreen") |>
    cols_label(
        Bar = ""
    )

    
```

